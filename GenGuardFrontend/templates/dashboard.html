<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="icon" type="image/x-icon" href="/static/img/logo.ico">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="dashboard.css">
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/js/dashboard.js" type="module"></script>
    <title>Admin</title>
    
  </head>
  <body>
    <nav class="navbar">
      <div class="navbar-container containernav">
        <input type="checkbox" name="" id="" />
        <div class="hamburger-lines">
          <span class="line line1"></span>
          <span class="line line2"></span>
          <span class="line line3"></span>
        </div>
        <ul class="menu-items">
            <li><a href="index.html">Home</a></li>
            <li id="login-signup-buttons">
                <button class="loginbtn navbutton"><a href="login.html">Login/Signup</a></button>
            </li>
            <li id="user-info" class="user-info">
              <span id="user-name" class="user-name">User</span>
              <div class="dropdown-content">
                <a href="profile.html"  class="logout-button">Profile</a>
                  <a href="dashboard.html" id="admin-button" class="logout-button">Admin</a>
                  <a href="logs.html" id="logs-button" class="logout-button">Logs</a>
                  <a id="logout-button" class="logout-button" onclick="logout()">Logout</a>

              </div>
          </li>
        </ul>
        <a href="index.html"><img src="/static/img/logo.png" class="logo"></a>
      </div>
    </nav>
    <h1 id="dashboard-title">Dashboard Admin Panel</h1>
    <!-- Dashboard content -->
    <div class="container mt-5">
        <div class="row">
            <!-- User Count Box -->
            <div class="col-md-3 col-12">
                <div class="card chart-card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title">User Count</h5>
                            <a type="button" class="btn button btn-primary" href="admin.html" >View Users</a>
                        </div>
                        <p class="card-text">Total users: -1</p>
                        <div class="chart-container">
                            <canvas id="adminVsRegularChart"></canvas>
                        </div>
                    </div>
                    <div class="card-body">
                        <div>
                            <h5 class="card-title">Users Permitted</h5>
                        </div>
                        <p class="card-text permittedCount">Permitted: -1</p>
                        <div class="chart-container">
                            <canvas id="permittedVsNotChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
             <!-- Table Control Box -->
             <div class="col-md-4 col-12">
                <div class="card">
                    <div class="card-body table-responsive">
                        <h5 class="card-title">Alarm</h5>
                        <table class="table table-hover">
                            <tr>
                                <th scope="col">Alaram Status</th>
                                <th scope="col">Zone alerted</th>
                                <th scope="col">Action</th>
                            </tr>
                            <tr>
                                <td scope="row" class="align-middle" id="text-bin">False</td>
                                <td scope="row" class="align-middle" id="text-zone">Zone -1</td>
                                <td scope="row" class="align-middle">
                                    <button type="button" class="btn btn-sm btn-success button button" id="start-alarm-button">Start Alarm</button>
                                    <button type="button" class="btn btn-sm btn-danger button button" id="stop-alarm-button">Stop Alarm</button>
                                </td>
                            </tr>
                        </table>
                        <br><br>
                        <h5 class="card-title pt-3 bold">System Status</h5>
                        <table class="table table-hover">
                            <tr>
                                <th scope="col">Service</th>
                                <th scope="col">Status</th>
                            </tr>
                            <tr>
                                <td scope="row" class="align-middle">Website</td>
                                <td scope="row" class="align-middle">
                                    <div class="status-indicator green"></div> <!-- Green for active or OK -->
                                </td>
                            </tr>
                            <tr>
                                <td scope="row" class="align-middle">Securtiy Camera</td>
                                <td scope="row" class="align-middle">
                                    <div class="status-indicator red"></div> <!-- Red for inactive or error -->
                                </td>
                            </tr>          
                        </table>                       
                    </div>
                </div>
            </div>

            <!-- Video Display Box -->
            <div class="col-md-4 col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Video Display</h5>
                        <div class="video-container d-flex flex-column justify-content-center align-items-center">
                            <!-- Video Stream -->
                            <img style="height: 250px; width: auto; max-width: 100%;" src="http://127.0.0.1:5000/video_feed" />
            
                            <!-- Arrow Controls Grid -->
                           <div id="control-grid" class="control-grid mt-3">
    <div class="row justify-content-center align-items-center">
        <div class="col text-center">
            <!-- Corrected button for moving UP -->
            <button onmousedown="sendCommand('moveUp')" onmouseup="stopMovement()" class="btn btn-light control-button">&#8593;</button>
        </div>
    </div>
    <div class="row justify-content-center align-items-center">
        <div class="col-4 text-center">
            <!-- Centered button for moving LEFT -->
            <button onmousedown="sendCommand('moveLeft')" onmouseup="stopMovement()" class="btn btn-light control-button">&#8592;</button>
        </div>
        <div class="col-4 text-center">
            <!-- Center button now also centered in its column -->
            <button onclick="sendCommand('center')" class="btn btn-secondary control-button">CENTER</button>
        </div>
        <div class="col-4 text-center">
            <!-- Centered button for moving RIGHT -->
            <button onmousedown="sendCommand('moveRight')" onmouseup="stopMovement()" class="btn btn-light control-button">&#8594;</button>
        </div>
    </div>
    <div class="row justify-content-center align-items-center">
        <div class="col text-center">
            <!-- Corrected button for moving DOWN -->
            <button onmousedown="sendCommand('moveDown')" onmouseup="stopMovement()" class="btn btn-light control-button">&#8595;</button>
        </div>
    </div>
</div>

                        </div>
                    </div>
                </div>
            </div>
            
            

            <script>
                let movementInterval;
                let espIpAddress;
            
                // Function to fetch IP address from Firebase
                function fetchIpAddress() {
                    // Assuming you're using Firebase JavaScript SDK
                    firebase.database().ref('/esp/ESPIP').once('value').then(function(snapshot) {
                        espIpAddress = snapshot.val();
                        console.log("Fetched IP Address: " + espIpAddress);
                    });
                }
            
                // Function to send command using fetched IP address
                function sendCommand(command) {
                    // If IP address is not fetched yet, fetch it first
                    if (!espIpAddress) {
                        fetchIpAddress();
                        return;
                    }
            
                    const url = espIpAddress + '/' + command;
            
                    // If already moving, don't start another interval
                    if (movementInterval) return;
            
                    movementInterval = setInterval(() => {
                        fetch(url)
                            .then(response => response.text())
                            .then(data => console.log(data))
                            .catch(error => console.error('Error:', error));
                    }, 100); // Adjust the interval time as needed
                }
            
                function stopMovement() {
                    clearInterval(movementInterval);
                    movementInterval = null;
                    // Optionally send a stop or idle command to the server
                    fetch('')
                        .then(response => response.text())
                        .then(data => console.log("Stopped: " + data))
                        .catch(error => console.error('Error stopping:', error));
                }
            </script>
               
            <!--LAST LOGIN-->
            <div id="lastlogin" class="col-md-4 col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title">Last login snapshot</h5>
                            <a type="button" class="btn btn-primary button button" href="logs.html">View Logs</a>
                        </div>
                        <div id="lastLoginImageContainer"><!-- Image will be displayed here --></div>
                        <p id="lastLoginDetails"></p>
                    </div>

                </div>
            </div>
        </div>
    </div>


    

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

</body>
</html>
